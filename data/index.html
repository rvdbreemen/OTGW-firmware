<!DOCTYPE html>
<html charset="UTF-8">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">  
    <link rel="stylesheet" type="text/css" href="./index.css" id="theme-style">
    <script>
      (function() {
        try {
          var storedTheme = localStorage.getItem('theme');
          if (storedTheme === 'dark') {
            document.getElementById('theme-style').href = "index_dark.css";
          }
        } catch (e) { console.error(e); }
      })();
    </script>
    <script src="./index.js"></script>
    <script src="./graph.js"></script>
    <title>OTGW firmware</title>
  </head>
  <body>
    <font face="Arial">
    <div class="headerrow">
        <div class="headercolumnbig" id="sysName">OTGW firmware</div>
        <div class="headercolumn" id="devName">[hostname]</div>
        <div class="headercolumn" id="devVersion">[version]</div>
        <div class="headercolumn" id='theTime'>[00:00:00]</div>
    </div>
    </font>
    <div id="displayMainPage">
      <div class="nav-container">
        <div class='nav-left'>
          <button class='home nav-item tabButton'>Home</button>
        </div>
        <div class='nav-right'>
          <button class='basicSettings nav-item tabButton'>Settings</button>
          <button class='adminSettings nav-item tabButton'>Advanced</button>
          <div class="adv_dropdown hidden">
            <span class="list_item tabPICflash">PIC firmware</span>
            <span class="list_item tabDeviceInfo">Debug Information</span>
            <span class="list_item FSexplorer">File system contents</span>
          </div>
        </div>
      </div>
      <div id="mainPage">
        <div id="waiting">Wait for it...</div>
      </div>
      
      <!-- OpenTherm Log Viewer Section -->
      <div id="otLogSection" class="ot-log-section">
        <div class="ot-log-header">
          <h3>OpenTherm Message Log</h3>
          <div class="ot-log-status">
            <span id="wsStatus" class="ws-status ws-disconnected">●</span>
            <span id="wsStatusText">Disconnected</span>
          </div>
        </div>
        
        <div class="ot-log-tabs">
          <button class="tab-link active" onclick="openLogTab(event, 'Log')">Log</button>
          <button class="tab-link" onclick="openLogTab(event, 'Statistics')">Statistics</button>
          <button class="tab-link" onclick="openLogTab(event, 'Graph')">Graph</button>
        </div>

        <div id="Log" class="tab-content active">
            <div class="ot-log-controls">
              <button id="btnToggleLog" class="btn-log-control" title="Expand/Collapse Log" aria-label="Expand or collapse the OpenTherm log view">▲ Show More</button>
              <button id="btnAutoScroll" class="btn-log-control btn-active" title="Auto-scroll with new messages" aria-label="Toggle auto-scroll with new log messages">Auto-scroll</button>
              <button id="btnClearLog" class="btn-log-control" title="Clear log buffer" aria-label="Clear the OpenTherm log buffer">Clear</button>
              <button id="btnDownloadLog" class="btn-log-control" title="Download log to file" aria-label="Download the OpenTherm log to a file">Download</button>
              <input type="text" id="searchLog" class="log-search" placeholder="Search logs..." aria-label="Search OpenTherm log messages" />
              <label class="log-control-label">
                <input type="checkbox" id="chkShowTimestamp" checked aria-label="Show timestamps in the OpenTherm log" />
                Timestamps
              </label>
            </div>
            
            <div id="otLogContainer" class="ot-log-container collapsed">
              <div id="otLogContent" class="ot-log-content" role="log" aria-live="polite"></div>
            </div>
            
            <div class="ot-log-footer">
              <span>Lines: <span id="logLineCount">0</span> / 2000</span>
              <span>Filtered: <span id="logFilteredCount">0</span></span>
            </div>
        </div>

        <div id="Statistics" class="tab-content">
             <div class="ot-stats-container">
                <table class="ot-stats-table" id="otStatsTable">
                    <thead>
                        <tr>
                            <th onclick="sortStats(0)">Hex</th>
                            <th onclick="sortStats(1)">Dec</th>
                            <th onclick="sortStats(2)">Direction</th>
                            <th onclick="sortStats(3)">Description</th>
                            <th onclick="sortStats(4)">Interval (s)</th>
                            <th onclick="sortStats(5)">Value</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
             </div>
             <div class="ot-log-footer">
                <span>Unique Messages: <span id="statsCount">0</span></span>
             </div>
        </div>

        <div id="Graph" class="tab-content">
            <div class="ot-graph-container">
               <canvas id="otGraphCanvas"></canvas>
            </div>
        </div>
      </div>
    </div>
    <div id="displayPICflash">
      <div class="nav-container">
        <div class='nav-left'>
          <button class='home nav-item tabButton'>Home</button>
        </div>
        <div class='nav-right'>
          <button class='basicSettings nav-item tabButton'>Settings</button>
          <button class='adminSettings nav-item tabButton'>Advanced</button>
          <div class="adv_dropdown hidden">
            <span class="list_item tabPICflash">PIC firmware</span>
            <span class="list_item tabDeviceInfo">Debug Information</span>
            <span class="list_item FSexplorer">File system contents</span>
          </div>
        </div>
      </div>
      <div id="displayPICpage"></div>
    </div>
    <div id="displayDeviceInfo">
      <div class="nav-container">
        <div class='nav-left'>
          <button class='home nav-item tabButton'>Home</button>
        </div>
        <div class='nav-right'>
          <button class='basicSettings nav-item tabButton'>Settings</button>
          <button class='adminSettings nav-item tabButton'>Advanced</button>
          <div class="adv_dropdown hidden">
            <span class="list_item tabPICflash">PIC firmware</span>
            <span class="list_item tabDeviceInfo">Debug Information</span>
            <span class="list_item FSexplorer">File system contents</span>
          </div>
        </div>
      </div>
      <div id="deviceinfoPage"></div>
    </div>
    <div id="displaySettingsPage">
      <div class="nav-container">
        <div class='nav-left'>
          <button class='home nav-item tabButton'>Home</button>
        </div>
        <div class='nav-right'>
          <button class='basicSettings nav-item tabButton'>Settings</button>
          <button class='adminSettings nav-item tabButton'>Advanced</button>
          <div class="adv_dropdown hidden">
            <span class="list_item tabPICflash">PIC firmware</span>
            <span class="list_item tabDeviceInfo">Debug Information</span>
            <span class="list_item FSexplorer">File system contents</span>
          </div>
        </div>
      </div>
      <div id="settingsPage"></div>
      <div id="settingMessage">Loading...</div>
    </div>
    <div class="footer">
      <div class="nav-left">
        <button class='nav-item tabButton btnSaveSettings hidden'>Save</button>
      </div>
    </div>
    <!-- KEEP THIS --->

    <!-- Pin to bottom right corner -->
    <div class="bottom right-0">2021-2026 &copy; Robert van den Breemen</div>

    <!-- Pin to bottom left corner -->
    <div id="message" class="bottom left-0"></div>
  
    <script>
       window.onload=initMainPage;
    </script>

  </body>

</html>
